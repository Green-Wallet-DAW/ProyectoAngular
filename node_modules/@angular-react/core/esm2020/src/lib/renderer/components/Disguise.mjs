// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
import * as React from 'react';
import * as ReactDOM from 'react-dom';
import { getPassProps } from '../../renderer/pass-prop-decorator';
import removeUndefinedProperties from '../../utils/object/remove-undefined-properties';
import { ReactContent } from '../react-content';
/**
 * A React component that can render a component and its children as other component types.
 */
export class Disguise extends React.PureComponent {
    render() {
        const { disguiseRootAs, disguiseChildrenAs, children, ngChildComponents, ...rest } = this.props;
        const renderedChildren = ngChildComponents
            ? this._isReactContentOnlyChild()
                ? this._renderReactContentChildren()
                : this._renderChildrenNaive()
            : children;
        if (disguiseRootAs != null) {
            return React.createElement(disguiseRootAs, rest || null, renderedChildren);
        }
        else {
            return React.createElement(React.Fragment, rest.key != null ? { key: rest.key } : null, renderedChildren);
        }
    }
    _isReactContentOnlyChild() {
        const { children } = this.props;
        if (React.Children.count(children) === 1) {
            const [onlyChild] = React.Children.toArray(children);
            if (typeof onlyChild === 'object' && onlyChild.type === ReactContent) {
                return true;
            }
        }
        return false;
    }
    _renderReactContentChildren() {
        const { ngChildComponents, disguiseChildrenAs } = this.props;
        const renderedChildren = ngChildComponents.map((child, index) => {
            const propsToPass = removeUndefinedProperties(getPassProps(child).reduce((acc, passProp) => Object.assign(acc, { [passProp.targetKey]: child[passProp.sourceKey] }), {}));
            return React.createElement(disguiseChildrenAs, {
                ...propsToPass,
                key: index,
                ref: childReactElement => {
                    // ref callback is called with null when the component unmounts from the DOM, we don't need to handle it.
                    if (!childReactElement) {
                        return;
                    }
                    ReactDOM.findDOMNode(childReactElement).appendChild(child.elementRef.nativeElement);
                },
            });
        });
        return renderedChildren;
    }
    _renderChildrenNaive() {
        const { children, disguiseChildrenAs } = this.props;
        const renderedChildren = React.Children.map(children, child => {
            if (!disguiseChildrenAs || typeof child !== 'object') {
                return child;
            }
            const ChildRoot = child.type || disguiseChildrenAs;
            return React.createElement(ChildRoot, { ...child.props, key: child.key }, child);
        });
        return renderedChildren;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGlzZ3Vpc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvcmUvc3JjL2xpYi9yZW5kZXJlci9jb21wb25lbnRzL0Rpc2d1aXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDREQUE0RDtBQUM1RCxrQ0FBa0M7QUFFbEMsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxLQUFLLFFBQVEsTUFBTSxXQUFXLENBQUM7QUFFdEMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ2xFLE9BQU8seUJBQXlCLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBMkJoRDs7R0FFRztBQUNILE1BQU0sT0FBTyxRQUFTLFNBQVEsS0FBSyxDQUFDLGFBQTRCO0lBQzlELE1BQU07UUFDSixNQUFNLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxHQUFHLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFaEcsTUFBTSxnQkFBZ0IsR0FBRyxpQkFBaUI7WUFDeEMsQ0FBQyxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtnQkFDL0IsQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRTtnQkFDcEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRTtZQUMvQixDQUFDLENBQUMsUUFBUSxDQUFDO1FBRWIsSUFBSSxjQUFjLElBQUksSUFBSSxFQUFFO1lBQzFCLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUUsSUFBSSxJQUFJLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1NBQzVFO2FBQU07WUFDTCxPQUFPLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztTQUMzRztJQUNILENBQUM7SUFFTyx3QkFBd0I7UUFDOUIsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFaEMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDeEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JELElBQUksT0FBTyxTQUFTLEtBQUssUUFBUSxJQUF3QixTQUFVLENBQUMsSUFBSSxLQUFLLFlBQVksRUFBRTtnQkFDekYsT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU8sMkJBQTJCO1FBQ2pDLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxrQkFBa0IsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFN0QsTUFBTSxnQkFBZ0IsR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDOUQsTUFBTSxXQUFXLEdBQUcseUJBQXlCLENBQzNDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQ3hCLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFDMUYsRUFBRSxDQUNILENBQ0YsQ0FBQztZQUVGLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsRUFBRTtnQkFDN0MsR0FBRyxXQUFXO2dCQUNkLEdBQUcsRUFBRSxLQUFLO2dCQUNWLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxFQUFFO29CQUN2Qix5R0FBeUc7b0JBQ3pHLElBQUksQ0FBQyxpQkFBaUIsRUFBRTt3QkFDdEIsT0FBTztxQkFDUjtvQkFFRCxRQUFRLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3RGLENBQUM7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sZ0JBQWdCLENBQUM7SUFDMUIsQ0FBQztJQUVPLG9CQUFvQjtRQUMxQixNQUFNLEVBQUUsUUFBUSxFQUFFLGtCQUFrQixFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUVwRCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsRUFBRTtZQUM1RCxJQUFJLENBQUMsa0JBQWtCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO2dCQUNwRCxPQUFPLEtBQUssQ0FBQzthQUNkO1lBRUQsTUFBTSxTQUFTLEdBQXVCLEtBQU0sQ0FBQyxJQUFJLElBQUksa0JBQWtCLENBQUM7WUFDeEUsT0FBTyxLQUFLLENBQUMsYUFBYSxDQUN4QixTQUFTLEVBQ1QsRUFBRSxHQUF1QixLQUFNLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBc0IsS0FBTSxDQUFDLEdBQUcsRUFBRSxFQUM1RSxLQUFLLENBQ04sQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5cclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xyXG5pbXBvcnQgeyBSZWFjdFdyYXBwZXJDb21wb25lbnQgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL3dyYXBwZXItY29tcG9uZW50JztcclxuaW1wb3J0IHsgZ2V0UGFzc1Byb3BzIH0gZnJvbSAnLi4vLi4vcmVuZGVyZXIvcGFzcy1wcm9wLWRlY29yYXRvcic7XHJcbmltcG9ydCByZW1vdmVVbmRlZmluZWRQcm9wZXJ0aWVzIGZyb20gJy4uLy4uL3V0aWxzL29iamVjdC9yZW1vdmUtdW5kZWZpbmVkLXByb3BlcnRpZXMnO1xyXG5pbXBvcnQgeyBSZWFjdENvbnRlbnQgfSBmcm9tICcuLi9yZWFjdC1jb250ZW50JztcclxuaW1wb3J0IHsgUmVhY3RFbGVtZW50IH0gZnJvbSAncmVhY3QnO1xyXG5cclxuLyoqXHJcbiAqIFByb3BzIGZvciBgRGlzZ3Vpc2VgIGNvbXBvbmVudC5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGlzZ3Vpc2VQcm9wcyB7XHJcbiAgLyoqXHJcbiAgICogVGhlIHR5cGUgdG8gcmVuZGVyIHRoZSByb290IGNvbXBvbmVudCBhcy5cclxuICAgKiBAZGVmYXVsdCBSZWFjdC5GcmFnbWVudFxyXG4gICAqL1xyXG4gIGRpc2d1aXNlUm9vdEFzPzogUmVhY3QuUmVhY3RUeXBlO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgdHlwZSB0byByZW5kZXIgdGhlIGNoaWxkIGNvbXBvbmVudHMgYXMuXHJcbiAgICogQGRlZmF1bHQgdGhlIENoaWxkcmVuJ3Mgb3duIHR5cGUuXHJcbiAgICovXHJcbiAgZGlzZ3Vpc2VDaGlsZHJlbkFzPzogUmVhY3QuUmVhY3RUeXBlO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgQW5ndWxhciBjaGlsZCBjb21wb25lbnRzIHRvIHJlbmRlci5cclxuICAgKi9cclxuICBuZ0NoaWxkQ29tcG9uZW50cz86IFJlYWN0V3JhcHBlckNvbXBvbmVudDxhbnk+W107XHJcblxyXG4gIGtleT86IHN0cmluZyB8IG51bWJlclxyXG59XHJcblxyXG4vKipcclxuICogQSBSZWFjdCBjb21wb25lbnQgdGhhdCBjYW4gcmVuZGVyIGEgY29tcG9uZW50IGFuZCBpdHMgY2hpbGRyZW4gYXMgb3RoZXIgY29tcG9uZW50IHR5cGVzLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIERpc2d1aXNlIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxEaXNndWlzZVByb3BzPiB7XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgY29uc3QgeyBkaXNndWlzZVJvb3RBcywgZGlzZ3Vpc2VDaGlsZHJlbkFzLCBjaGlsZHJlbiwgbmdDaGlsZENvbXBvbmVudHMsIC4uLnJlc3QgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZHJlbiA9IG5nQ2hpbGRDb21wb25lbnRzXHJcbiAgICAgID8gdGhpcy5faXNSZWFjdENvbnRlbnRPbmx5Q2hpbGQoKVxyXG4gICAgICAgID8gdGhpcy5fcmVuZGVyUmVhY3RDb250ZW50Q2hpbGRyZW4oKVxyXG4gICAgICAgIDogdGhpcy5fcmVuZGVyQ2hpbGRyZW5OYWl2ZSgpXHJcbiAgICAgIDogY2hpbGRyZW47XHJcblxyXG4gICAgaWYgKGRpc2d1aXNlUm9vdEFzICE9IG51bGwpIHtcclxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzZ3Vpc2VSb290QXMsIHJlc3QgfHwgbnVsbCwgcmVuZGVyZWRDaGlsZHJlbik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgcmVzdC5rZXkgIT0gbnVsbCA/IHsga2V5OiByZXN0LmtleSB9IDogbnVsbCwgcmVuZGVyZWRDaGlsZHJlbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9pc1JlYWN0Q29udGVudE9ubHlDaGlsZCgpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgaWYgKFJlYWN0LkNoaWxkcmVuLmNvdW50KGNoaWxkcmVuKSA9PT0gMSkge1xyXG4gICAgICBjb25zdCBbb25seUNoaWxkXSA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pO1xyXG4gICAgICBpZiAodHlwZW9mIG9ubHlDaGlsZCA9PT0gJ29iamVjdCcgJiYgKDxSZWFjdEVsZW1lbnQ8YW55Pj5vbmx5Q2hpbGQpLnR5cGUgPT09IFJlYWN0Q29udGVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfcmVuZGVyUmVhY3RDb250ZW50Q2hpbGRyZW4oKSB7XHJcbiAgICBjb25zdCB7IG5nQ2hpbGRDb21wb25lbnRzLCBkaXNndWlzZUNoaWxkcmVuQXMgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZHJlbiA9IG5nQ2hpbGRDb21wb25lbnRzLm1hcCgoY2hpbGQsIGluZGV4KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BzVG9QYXNzID0gcmVtb3ZlVW5kZWZpbmVkUHJvcGVydGllcyhcclxuICAgICAgICBnZXRQYXNzUHJvcHMoY2hpbGQpLnJlZHVjZShcclxuICAgICAgICAgIChhY2MsIHBhc3NQcm9wKSA9PiBPYmplY3QuYXNzaWduKGFjYywgeyBbcGFzc1Byb3AudGFyZ2V0S2V5XTogY2hpbGRbcGFzc1Byb3Auc291cmNlS2V5XSB9KSxcclxuICAgICAgICAgIHt9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzZ3Vpc2VDaGlsZHJlbkFzLCB7XHJcbiAgICAgICAgLi4ucHJvcHNUb1Bhc3MsXHJcbiAgICAgICAga2V5OiBpbmRleCxcclxuICAgICAgICByZWY6IGNoaWxkUmVhY3RFbGVtZW50ID0+IHtcclxuICAgICAgICAgIC8vIHJlZiBjYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBudWxsIHdoZW4gdGhlIGNvbXBvbmVudCB1bm1vdW50cyBmcm9tIHRoZSBET00sIHdlIGRvbid0IG5lZWQgdG8gaGFuZGxlIGl0LlxyXG4gICAgICAgICAgaWYgKCFjaGlsZFJlYWN0RWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgUmVhY3RET00uZmluZERPTU5vZGUoY2hpbGRSZWFjdEVsZW1lbnQpLmFwcGVuZENoaWxkKGNoaWxkLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmVuZGVyZWRDaGlsZHJlbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3JlbmRlckNoaWxkcmVuTmFpdmUoKSB7XHJcbiAgICBjb25zdCB7IGNoaWxkcmVuLCBkaXNndWlzZUNoaWxkcmVuQXMgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZHJlbiA9IFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgY2hpbGQgPT4ge1xyXG4gICAgICBpZiAoIWRpc2d1aXNlQ2hpbGRyZW5BcyB8fCB0eXBlb2YgY2hpbGQgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBDaGlsZFJvb3QgPSAoPFJlYWN0RWxlbWVudDxhbnk+PmNoaWxkKS50eXBlIHx8IGRpc2d1aXNlQ2hpbGRyZW5BcztcclxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXHJcbiAgICAgICAgQ2hpbGRSb290LFxyXG4gICAgICAgIHsgLi4uKDxSZWFjdEVsZW1lbnQ8YW55Pj5jaGlsZCkucHJvcHMsIGtleTogKDxSZWFjdEVsZW1lbnQ8YW55Pj5jaGlsZCkua2V5IH0sXHJcbiAgICAgICAgY2hpbGRcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZW5kZXJlZENoaWxkcmVuO1xyXG4gIH1cclxufVxyXG4iXX0=